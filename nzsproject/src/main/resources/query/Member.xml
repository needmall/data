<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.needmall.client.member.dao.MemberDao">
	<select id="customerSecuritySelect" parameterType="String" resultType="security">
		select c_id, salt from membersecurity 
		where c_id = #{c_id}
	</select>
	<!-- ORA-00911: 문자가 부적합합니다 =>> ; 찍혀있었음 ↑ -->
	<select id="sellerSecuritySelect" parameterType="String" resultType="security">
		select s_id, salt from membersecurity
		where s_id = #{s_id}
	</select>	
	
	<insert id="customerSecurityInsert" parameterType="security">
		/* customerSecurity - "customerSecurityInsert" */
		<selectKey keyProperty="mc_num" resultType="int" order="BEFORE">
			select membersecurity_seq.nextval from dual
		</selectKey>
		insert into membersecurity(mc_num, c_id, salt)
		values(#{mc_num}, #{c_id}, #{salt})
	</insert>
	
	<insert id="sellerSecurityInsert" parameterType="security">
		/* sellerSecurity - "sellerSecurityInsert" */
		<selectKey keyProperty="mc_num" resultType="int" order="BEFORE">
			select membersecurity_seq.nextval from dual
		</selectKey>
		insert into membersecurity(mc_num, s_id, salt)
		values(#{mc_num}, #{s_id}, #{salt})
	</insert>
	
	<select id="customerSelect" parameterType="String" resultType="int">
		select count(c_num)
		from customer
		where c_id = #{c_id}
	</select>
	
	<select id="sellerSelect" parameterType="String" resultType="int">
		select count(s_num)
		from seller
		where s_id = #{s_id}
	</select>
	
	<insert id="customerInsert" parameterType="member">
		/* customer - "customerInsert" */
		<selectKey keyProperty="c_num" resultType="int" order="BEFORE">
			select customer_seq.nextval from dual
		</selectKey>
		insert into customer(c_num, cs_division, c_id, c_pwd, c_name, c_gender, c_birthday, c_address, c_mail, c_cell)
		values(#{c_num}, #{cs_division}, #{c_id}, #{c_pwd}, #{c_name}, #{c_gender}, #{c_birthday}, #{c_address}, #{c_mail}, #{c_cell})
	</insert>	
	
	<select id="reqstoreSelect" parameterType="String" resultType="join">
		select reqst_num, s_num, st_bnum, st_name, st_address, st_email, st_hours, st_cell, st_ceo
		from reqstore
		where st_bnum = #{st_bnum}
	</select>
	<!-- reqstore 에 없는 st_num 넣었더니 '부적합한 식별자' 뜸 -->
	
	<insert id="sellerInsert" parameterType="join">
		/* seller - "sellerInsert" */
		<selectKey keyProperty="s_num" resultType="int" order="BEFORE">
			select seller_seq.nextval from dual
		</selectKey>
		insert into seller(s_num, cs_division, s_id, s_pwd, s_name, s_gender, s_birthday, s_address, s_mail, s_phone, s_cell)
		values(#{s_num}, #{cs_division}, #{s_id}, #{s_pwd}, #{s_name}, #{s_gender}, #{s_birthday}, #{s_address}, #{s_mail}, #{s_phone}, #{s_cell})
	</insert>
	
	<insert id="reqstoreInsert" parameterType="join">
		/* store - "reqstoreInsert" */
		<selectKey keyProperty="s_num" resultType="int" order="BEFORE">
			select s_num from seller
			where s_id = #{s_id}
		</selectKey>
		insert into reqstore(reqst_num, s_num, st_bnum, st_name, st_address, st_email, st_hours, st_cell, st_ceo, st_date)
		values(reqstore_seq.nextval, #{s_num}, #{st_bnum}, #{st_name}, #{st_address}, #{st_email}, #{st_hours}, #{st_cell}, #{st_ceo}, sysdate)
	</insert>
	
</mapper>